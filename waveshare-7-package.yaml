esphome:
  platformio_options:
    build_flags:
      - "-DCONFIG_COMPILER_OPTIMIZATION_PERF=y"
    board_build.arduino.memory_type: qio_opi

esp32:
  flash_size: 16MB
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_COMPILER_OPTIMIZATION_PERF: "y"
      CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_240: "y"

psram:
  speed: 80MHz

# --- API status ---
api:
  on_client_connected:
    - if:
        condition:
          lambda: 'return (0 == client_info.find("Home Assistant "));'
        then:
          - lvgl.widget.show: lbl_hastatus
  on_client_disconnected:
    - if:
        condition:
          lambda: 'return (0 == client_info.find("Home Assistant "));'
        then:
          - lvgl.widget.hide: lbl_hastatus

# --- Time ---
time:
  - platform: homeassistant
    id: ha_time

# --- Sensors ---
sensor:
  - platform: homeassistant
    id: weather_temp
    entity_id: weather.openweather
    attribute: temperature
  - platform: homeassistant
    id: weather_humidity
    entity_id: weather.openweather
    attribute: humidity
  - platform: homeassistant
    id: weather_dew_point
    entity_id: sensor.openweather_dew_point
  # Powietrze (Syngeos Żelazna)
  - platform: homeassistant
    id: pm25
    entity_id: sensor.syngeos_zelazna_pm2_5
  - platform: homeassistant
    id: pm10
    entity_id: sensor.syngeos_zelazna_pm10
  # Strefa dzienna
  - platform: homeassistant
    id: salon_temp
    entity_id: sensor.ble_temperature_e72e01820502
  - platform: homeassistant
    id: salon_humidity
    entity_id: sensor.ble_humidity_e72e01820502
  - platform: homeassistant
    id: salon_dew_point
    entity_id: sensor.salon_punkt_rosy
  - platform: homeassistant
    id: salon_thermostat
    entity_id: climate.salon_grzejnik_pid
    attribute: temperature
  # Sypialnia
  - platform: homeassistant
    id: sypialnia_temp
    entity_id: sensor.ble_temperature_termometr_sypialnia
  - platform: homeassistant
    id: sypialnia_humidity
    entity_id: sensor.ble_humidity_termometr_sypialnia
  - platform: homeassistant
    id: sypialnia_dew_point
    entity_id: sensor.sypialnia_punkt_rosy
  - platform: homeassistant
    id: sypialnia_thermostat
    entity_id: climate.sypialnia_grzejnik_pid
    attribute: temperature

text_sensor:
  - platform: homeassistant
    id: weather_condition
    entity_id: weather.openweather
  - platform: homeassistant
    id: salon_preset
    entity_id: select.salon_adaptive_preset

# --- Fonts ---
font:
  - file: "gfonts://Montserrat"
    id: icon_font_14
    size: 14
    bpp: 4
    glyphs: ' !"%()+,-./0123456789:;?°·—ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzĄĆĘŁŃÓŚŹŻąćęłńóśźżµ³'
    extras:
      - file:
          type: web
          url: "https://github.com/Templarian/MaterialDesign-Webfont/raw/master/fonts/materialdesignicons-webfont.ttf"
        glyphs:
          - "\U000F0590"  # weather-cloudy
          - "\U000F0591"  # weather-fog
          - "\U000F0592"  # weather-hail
          - "\U000F0593"  # weather-lightning
          - "\U000F0594"  # weather-night
          - "\U000F0595"  # weather-partly-cloudy
          - "\U000F0596"  # weather-pouring
          - "\U000F0597"  # weather-rainy
          - "\U000F0598"  # weather-snowy
          - "\U000F0599"  # weather-sunny
          - "\U000F059D"  # weather-windy
          - "\U000F059E"  # weather-windy-variant
          - "\U000F067E"  # weather-lightning-rainy
          - "\U000F067F"  # weather-snowy-rainy
          - "\U000F058E"  # water-percent
          - "\U000F050F"  # thermometer
          - "\U000F07D0"  # home-assistant
          - "\U000F0335"  # lightbulb
  - file: "gfonts://Montserrat"
    id: icon_font_28
    size: 28
    bpp: 4
    glyphs: " "
    extras:
      - file:
          type: web
          url: "https://github.com/Templarian/MaterialDesign-Webfont/raw/master/fonts/materialdesignicons-webfont.ttf"
        glyphs:
          - "\U000F0590"  # weather-cloudy
          - "\U000F0591"  # weather-fog
          - "\U000F0592"  # weather-hail
          - "\U000F0593"  # weather-lightning
          - "\U000F0594"  # weather-night
          - "\U000F0595"  # weather-partly-cloudy
          - "\U000F0596"  # weather-pouring
          - "\U000F0597"  # weather-rainy
          - "\U000F0598"  # weather-snowy
          - "\U000F0599"  # weather-sunny
          - "\U000F059D"  # weather-windy
          - "\U000F059E"  # weather-windy-variant
          - "\U000F067E"  # weather-lightning-rainy
          - "\U000F067F"  # weather-snowy-rainy
          - "\U000F04B9"  # sofa
          - "\U000F02E3"  # bed
          - "\U000F0335"  # lightbulb
  - file: "gfonts://Montserrat"
    id: icon_font_72
    size: 72
    bpp: 4
    glyphs: " "
    extras:
      - file:
            type: web
            url: "https://github.com/Templarian/MaterialDesign-Webfont/raw/master/fonts/materialdesignicons-webfont.ttf"
        glyphs:
          - "\U000F0590"  # weather-cloudy
          - "\U000F0591"  # weather-fog
          - "\U000F0592"  # weather-hail
          - "\U000F0593"  # weather-lightning
          - "\U000F0594"  # weather-night
          - "\U000F0595"  # weather-partly-cloudy
          - "\U000F0596"  # weather-pouring
          - "\U000F0597"  # weather-rainy
          - "\U000F0598"  # weather-snowy
          - "\U000F0599"  # weather-sunny
          - "\U000F059D"  # weather-windy
          - "\U000F059E"  # weather-windy-variant
          - "\U000F067E"  # weather-lightning-rainy
          - "\U000F067F"  # weather-snowy-rainy
          - "\U000F0322"  # laptop
          - "\U000F02E3"  # bed
  - file: "gfonts://Montserrat"
    id: font_18
    size: 18
    bpp: 4
    glyphs: ' !"%()+,-./0123456789:;?°·—ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzĄĆĘŁŃÓŚŹŻąćęłńóśźżµ³'

# --- LVGL UI ---
lvgl:
  theme:
    label:
      text_font: icon_font_14
      text_color: 0xFFFFFF
    button:
      bg_color: 0x333348
      bg_grad_color: 0x1E1E30
      bg_grad_dir: VER
      bg_dither_mode: ERR_DIFF
      bg_opa: COVER
      border_width: 0
      radius: 12
      text_color: 0xFFFFFF
      pressed:
        bg_color: 0x404058
        bg_grad_color: 0x282840
      checked:
        bg_color: 0xF0A830
        bg_grad_color: 0xC07818
        text_color: 0x1A1A2E
    buttonmatrix:
      bg_opa: TRANSP
      border_width: 0
      text_color: 0xFFFFFF
      pad_all: 4
      items:
        bg_color: 0x333348
        bg_grad_color: 0x1E1E30
        bg_grad_dir: VER
        bg_dither_mode: ERR_DIFF
        bg_opa: COVER
        border_width: 0
        radius: 8
        text_color: 0xFFFFFF
        text_font: icon_font_14
        pressed:
          bg_color: 0x404058
          bg_grad_color: 0x282840
        checked:
          bg_color: 0xF0A830
          bg_grad_color: 0xC07818
          text_color: 0x1A1A2E
    switch:
      bg_color: 0x404050
      bg_opa: COVER
      checked:
        bg_color: 0xE8A030
        bg_opa: COVER
      knob:
        bg_color: 0xFFFFFF
        bg_opa: COVER
    slider:
      bg_color: 0x303040
      bg_opa: COVER
      border_width: 0
      indicator:
        bg_color: 0xE8A030
        bg_opa: COVER
      knob:
        bg_color: 0xFFFFFF
        bg_opa: COVER
        border_width: 0
  style_definitions:
    - id: card
      bg_color: 0x2E2E48
      bg_grad_color: 0x0C0C18
      bg_grad_dir: VER
      bg_dither_mode: ERR_DIFF
      bg_opa: COVER
      border_width: 0
      radius: 12
      pad_all: 12
      text_color: 0xFFFFFF
    - id: chip
      bg_color: 0x333348
      bg_grad_color: 0x1E1E30
      bg_grad_dir: VER
      bg_dither_mode: ERR_DIFF
      bg_opa: COVER
      border_width: 0
      radius: 16
      pad_left: 12
      pad_right: 12
      pad_top: 4
      pad_bottom: 4
      text_color: 0xFFFFFF
    - id: section_title
      text_color: 0x9E9E9E
      bg_opa: TRANSP
  pages:
    - id: main_page
      bg_color: 0x000000
      scrollbar_mode: "OFF"
      scrollable: false
      widgets:
        # Status bar
        - obj:
            width: 800
            height: 32
            border_width: 0
            radius: 0
            scrollbar_mode: "OFF"
            scrollable: false
            x: 0
            y: 0
            bg_color: 0x222230
            bg_grad_color: 0x0A0A10
            bg_grad_dir: VER
            bg_dither_mode: ERR_DIFF
            bg_opa: COVER
            pad_left: 8
            pad_right: 8
            widgets:
              - label:
                  id: lbl_clock
                  align: LEFT_MID
                  text_color: 0xFFFFFF
                  text_font: montserrat_28
                  text: "--:--"
              - label:
                  id: lbl_pm25
                  align: LEFT_MID
                  x: 130
                  text_color: 0xFFFFFF
                  text_font: icon_font_14
                  text: "PM2.5: --"
              - label:
                  id: lbl_pm10
                  align: LEFT_MID
                  x: 290
                  text_color: 0xFFFFFF
                  text_font: icon_font_14
                  text: "PM10: --"
              - label:
                  id: lbl_date
                  align: RIGHT_MID
                  x: -20
                  text_color: 0xFFFFFF
                  text_font: icon_font_14
                  text: ""
              - label:
                  id: lbl_hastatus
                  align: RIGHT_MID
                  hidden: true
                  text_color: 0xFFFFFF
                  text_font: icon_font_14
                  text: "\U000F07D0"
        # --- Room Cards Row (120px each) ---
        # Card 1: Strefa dzienna
        - obj:
            id: card_sz
            styles: card
            x: 8
            y: 40
            width: 256
            height: 120
            scrollable: false
            border_width: 2
            border_color: 0xE8A030
            on_click:
              then:
                - lvgl.widget.show: panel_sz
                - lvgl.widget.hide: panel_syp
                - lvgl.widget.hide: panel_pogoda
                - lvgl.widget.hide: panel_zakupy
                - lvgl.widget.hide: panel_tramwaje
                - lvgl.widget.hide: panel_ustawienia
                - lvgl.widget.update:
                    id: card_sz
                    border_color: 0xE8A030
                - lvgl.widget.update:
                    id: card_syp
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_pogoda
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: btn_tab_zakupy
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_tramwaje
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_ustawienia
                    state:
                      checked: false
            widgets:
              - label:
                  text: "Strefa dzienna"
                  text_font: font_18
              - label:
                  id: lbl_sz_temp
                  y: 26
                  text: "-- °C"
                  text_font: montserrat_28
              - label:
                  id: lbl_sz_details
                  y: 58
                  text_color: 0x9E9E9E
                  text: ""
              - label:
                  id: lbl_sz_thermostat
                  y: 76
                  text_color: 0x9E9E9E
                  text: ""
              - label:
                  align: TOP_RIGHT
                  text: "\U000F0322"
                  text_font: icon_font_72
                  text_color: 0xE8A030
        # Card 2: Sypialnia
        - obj:
            id: card_syp
            styles: card
            x: 272
            y: 40
            width: 256
            height: 120
            scrollable: false
            border_width: 2
            border_color: 0x1C1C2E
            on_click:
              then:
                - lvgl.widget.hide: panel_sz
                - lvgl.widget.show: panel_syp
                - lvgl.widget.hide: panel_pogoda
                - lvgl.widget.hide: panel_zakupy
                - lvgl.widget.hide: panel_tramwaje
                - lvgl.widget.hide: panel_ustawienia
                - lvgl.widget.update:
                    id: card_sz
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_syp
                    border_color: 0xE8A030
                - lvgl.widget.update:
                    id: card_pogoda
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: btn_tab_zakupy
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_tramwaje
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_ustawienia
                    state:
                      checked: false
            widgets:
              - label:
                  text: "Sypialnia"
                  text_font: font_18
              - label:
                  id: lbl_syp_temp
                  y: 26
                  text: "-- °C"
                  text_font: montserrat_28
              - label:
                  id: lbl_syp_details
                  y: 58
                  text_color: 0x9E9E9E
                  text: ""
              - label:
                  id: lbl_syp_thermostat
                  y: 76
                  text_color: 0x9E9E9E
                  text: ""
              - label:
                  align: TOP_RIGHT
                  text: "\U000F02E3"
                  text_font: icon_font_72
                  text_color: 0xE8A030
        # Card 3: Pogoda
        - obj:
            id: card_pogoda
            styles: card
            x: 536
            y: 40
            width: 256
            height: 120
            scrollable: false
            border_width: 2
            border_color: 0x1C1C2E
            on_click:
              then:
                - lvgl.widget.hide: panel_sz
                - lvgl.widget.hide: panel_syp
                - lvgl.widget.show: panel_pogoda
                - lvgl.widget.hide: panel_zakupy
                - lvgl.widget.hide: panel_tramwaje
                - lvgl.widget.hide: panel_ustawienia
                - lvgl.widget.update:
                    id: card_sz
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_syp
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_pogoda
                    border_color: 0xE8A030
                - lvgl.widget.update:
                    id: btn_tab_zakupy
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_tramwaje
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_ustawienia
                    state:
                      checked: false
            widgets:
              - label:
                  text: "Pogoda"
                  text_font: font_18
              - label:
                  id: lbl_pogoda_temp
                  y: 26
                  text: "-- °C"
                  text_font: montserrat_28
              - label:
                  id: lbl_pogoda_condition
                  y: 58
                  text_color: 0x9E9E9E
                  text: ""
              - label:
                  id: lbl_pogoda_details
                  y: 76
                  text_color: 0x9E9E9E
                  text: ""
              - label:
                  id: lbl_pogoda_icon
                  align: TOP_RIGHT
                  text: ""
                  text_font: icon_font_72
                  text_color: 0xE8A030
        # --- Tab Bar (individual buttons) ---
        - button:
            id: btn_tab_zakupy
            x: 8
            y: 440
            width: 256
            height: 36
            checkable: true
            on_click:
              then:
                - lvgl.widget.hide: panel_sz
                - lvgl.widget.hide: panel_syp
                - lvgl.widget.hide: panel_pogoda
                - lvgl.widget.show: panel_zakupy
                - lvgl.widget.hide: panel_tramwaje
                - lvgl.widget.hide: panel_ustawienia
                - lvgl.widget.update:
                    id: card_sz
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_syp
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_pogoda
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: btn_tab_zakupy
                    state:
                      checked: true
                - lvgl.widget.update:
                    id: btn_tab_tramwaje
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_ustawienia
                    state:
                      checked: false
            widgets:
              - label:
                  align: CENTER
                  text: "Zakupy"
        - button:
            id: btn_tab_tramwaje
            x: 272
            y: 440
            width: 256
            height: 36
            checkable: true
            on_click:
              then:
                - lvgl.widget.hide: panel_sz
                - lvgl.widget.hide: panel_syp
                - lvgl.widget.hide: panel_pogoda
                - lvgl.widget.hide: panel_zakupy
                - lvgl.widget.show: panel_tramwaje
                - lvgl.widget.hide: panel_ustawienia
                - lvgl.widget.update:
                    id: card_sz
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_syp
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_pogoda
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: btn_tab_zakupy
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_tramwaje
                    state:
                      checked: true
                - lvgl.widget.update:
                    id: btn_tab_ustawienia
                    state:
                      checked: false
            widgets:
              - label:
                  align: CENTER
                  text: "Tramwaje"
        - button:
            id: btn_tab_ustawienia
            x: 536
            y: 440
            width: 256
            height: 36
            checkable: true
            on_click:
              then:
                - lvgl.widget.hide: panel_sz
                - lvgl.widget.hide: panel_syp
                - lvgl.widget.hide: panel_pogoda
                - lvgl.widget.hide: panel_zakupy
                - lvgl.widget.hide: panel_tramwaje
                - lvgl.widget.show: panel_ustawienia
                - lvgl.widget.update:
                    id: card_sz
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_syp
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: card_pogoda
                    border_color: 0x1C1C2E
                - lvgl.widget.update:
                    id: btn_tab_zakupy
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_tramwaje
                    state:
                      checked: false
                - lvgl.widget.update:
                    id: btn_tab_ustawienia
                    state:
                      checked: true
            widgets:
              - label:
                  align: CENTER
                  text: "Ustawienia"
        # --- Tab Panels ---
        - obj:
            id: panel_sz
            x: 8
            y: 168
            width: 784
            height: 264
            bg_opa: TRANSP
            border_width: 0
            pad_all: 0
            scrollable: false
            widgets:
              # Adaptive lighting presets
              - buttonmatrix:
                  id: preset_buttons
                  width: 784
                  height: 48
                  pad_all: 0
                  one_checked: true
                  rows:
                    - buttons:
                        - id: btn_preset_off
                          text: "Off"
                          control:
                            checkable: true
                          on_press:
                            then:
                              - homeassistant.service:
                                  service: light.turn_off
                                  data:
                                    entity_id: "light.hue_white_light_1, light.hue_white_light_1_3, light.hue_white_light_1_4"
                        - id: btn_preset_ciemniej
                          text: "Ciemniej"
                          control:
                            checkable: true
                          on_press:
                            then:
                              - homeassistant.service:
                                  service: select.select_option
                                  data:
                                    entity_id: select.salon_adaptive_preset
                                    option: "Trochę ciemniej"
                        - id: btn_preset_normalnie
                          text: "Normalnie"
                          control:
                            checkable: true
                          on_press:
                            then:
                              - homeassistant.service:
                                  service: select.select_option
                                  data:
                                    entity_id: select.salon_adaptive_preset
                                    option: "Normalne"
                        - id: btn_preset_jasniej
                          text: "Jaśniej"
                          control:
                            checkable: true
                          on_press:
                            then:
                              - homeassistant.service:
                                  service: select.select_option
                                  data:
                                    entity_id: select.salon_adaptive_preset
                                    option: "Trochę jaśniej"
                        - id: btn_preset_100
                          text: "100%"
                          control:
                            checkable: true
                          on_press:
                            then:
                              - homeassistant.service:
                                  service: select.select_option
                                  data:
                                    entity_id: select.salon_adaptive_preset
                                    option: "100%"
        - obj:
            id: panel_syp
            hidden: true
            x: 8
            y: 168
            width: 784
            height: 264
            bg_opa: TRANSP
            border_width: 0
            pad_all: 0
            scrollable: false
            widgets:
              - label:
                  align: CENTER
                  text: "Sypialnia"
                  text_color: 0x9E9E9E
        - obj:
            id: panel_pogoda
            hidden: true
            x: 8
            y: 168
            width: 784
            height: 264
            bg_opa: TRANSP
            border_width: 0
            pad_all: 0
            scrollable: false
            widgets:
              - label:
                  align: CENTER
                  text: "Pogoda"
                  text_color: 0x9E9E9E
        - obj:
            id: panel_zakupy
            hidden: true
            x: 8
            y: 168
            width: 784
            height: 264
            bg_opa: TRANSP
            border_width: 0
            pad_all: 0
            scrollable: false
            widgets:
              - label:
                  align: CENTER
                  text: "Zakupy"
                  text_color: 0x9E9E9E
        - obj:
            id: panel_tramwaje
            hidden: true
            x: 8
            y: 168
            width: 784
            height: 264
            bg_opa: TRANSP
            border_width: 0
            pad_all: 0
            scrollable: false
            widgets:
              - label:
                  align: CENTER
                  text: "Tramwaje"
                  text_color: 0x9E9E9E
        - obj:
            id: panel_ustawienia
            hidden: true
            x: 8
            y: 168
            width: 784
            height: 264
            bg_opa: TRANSP
            border_width: 0
            pad_all: 0
            scrollable: false
            widgets:
              - label:
                  align: CENTER
                  text: "Ustawienia"
                  text_color: 0x9E9E9E

# --- Clock update ---
interval:
  - interval: 1s
    then:
      - lvgl.label.update:
          id: lbl_clock
          text: !lambda |-
            auto now = id(ha_time).now();
            if (!now.is_valid()) return std::string("--:--");
            char buf[6];
            snprintf(buf, sizeof(buf), "%02d:%02d", now.hour, now.minute);
            return std::string(buf);
      - lvgl.label.update:
          id: lbl_pm25
          text: !lambda |-
            float v = id(pm25).state;
            if (std::isnan(v)) return std::string("PM2.5: --");
            char buf[20];
            snprintf(buf, sizeof(buf), "PM2.5: %.0f µg/m³", v);
            return std::string(buf);
      - lvgl.label.update:
          id: lbl_pm10
          text: !lambda |-
            float v = id(pm10).state;
            if (std::isnan(v)) return std::string("PM10: --");
            char buf[20];
            snprintf(buf, sizeof(buf), "PM10: %.0f µg/m³", v);
            return std::string(buf);
      - lvgl.label.update:
          id: lbl_date
          text: !lambda |-
            auto now = id(ha_time).now();
            if (!now.is_valid()) return std::string("");
            const char *days[] = {"niedz.", "pon.", "wt.", "śr.", "czw.", "pt.", "sob."};
            const char *months[] = {"stycznia", "lutego", "marca", "kwietnia", "maja", "czerwca",
                                    "lipca", "sierpnia", "września", "października", "listopada", "grudnia"};
            char buf[40];
            snprintf(buf, sizeof(buf), "%s, %d %s %d r.", days[now.day_of_week - 1], now.day_of_month, months[now.month - 1], now.year);
            return std::string(buf);
  - interval: 10s
    then:
      # --- Helper: comma-formatted number ---
      # Strefa dzienna
      - lvgl.label.update:
          id: lbl_sz_temp
          text: !lambda |-
            float v = id(salon_temp).state;
            if (std::isnan(v)) return std::string("-- °C");
            char n[8]; snprintf(n, sizeof(n), "%.1f", v);
            for (char *p = n; *p; p++) if (*p == '.') *p = ',';
            return std::string(n) + " °C";
      - lvgl.label.update:
          id: lbl_sz_details
          text: !lambda |-
            float h = id(salon_humidity).state;
            float d = id(salon_dew_point).state;
            if (std::isnan(h)) return std::string("");
            char hs[8], ds[8];
            snprintf(hs, sizeof(hs), "%.1f", h);
            for (char *p = hs; *p; p++) if (*p == '.') *p = ',';
            std::string r = std::string(hs) + "%";
            if (!std::isnan(d)) {
              snprintf(ds, sizeof(ds), "%.1f", d);
              for (char *p = ds; *p; p++) if (*p == '.') *p = ',';
              r += " · p.rosy " + std::string(ds) + " °C";
            }
            return r;
      - lvgl.label.update:
          id: lbl_sz_thermostat
          text: !lambda |-
            float v = id(salon_thermostat).state;
            if (std::isnan(v)) return std::string("Grzejnik: --");
            char n[8]; snprintf(n, sizeof(n), "%.1f", v);
            for (char *p = n; *p; p++) if (*p == '.') *p = ',';
            return "Grzejnik: " + std::string(n) + " °C";
      # Sypialnia
      - lvgl.label.update:
          id: lbl_syp_temp
          text: !lambda |-
            float v = id(sypialnia_temp).state;
            if (std::isnan(v)) return std::string("-- °C");
            char n[8]; snprintf(n, sizeof(n), "%.1f", v);
            for (char *p = n; *p; p++) if (*p == '.') *p = ',';
            return std::string(n) + " °C";
      - lvgl.label.update:
          id: lbl_syp_details
          text: !lambda |-
            float h = id(sypialnia_humidity).state;
            float d = id(sypialnia_dew_point).state;
            if (std::isnan(h)) return std::string("");
            char hs[8], ds[8];
            snprintf(hs, sizeof(hs), "%.1f", h);
            for (char *p = hs; *p; p++) if (*p == '.') *p = ',';
            std::string r = std::string(hs) + "%";
            if (!std::isnan(d)) {
              snprintf(ds, sizeof(ds), "%.1f", d);
              for (char *p = ds; *p; p++) if (*p == '.') *p = ',';
              r += " · p.rosy " + std::string(ds) + " °C";
            }
            return r;
      - lvgl.label.update:
          id: lbl_syp_thermostat
          text: !lambda |-
            float v = id(sypialnia_thermostat).state;
            if (std::isnan(v)) return std::string("Grzejnik: --");
            char n[8]; snprintf(n, sizeof(n), "%.1f", v);
            for (char *p = n; *p; p++) if (*p == '.') *p = ',';
            return "Grzejnik: " + std::string(n) + " °C";
      # Pogoda
      - lvgl.label.update:
          id: lbl_pogoda_temp
          text: !lambda |-
            float v = id(weather_temp).state;
            if (std::isnan(v)) return std::string("-- °C");
            char n[8]; snprintf(n, sizeof(n), "%.0f", v);
            return std::string(n) + " °C";
      - lvgl.label.update:
          id: lbl_pogoda_condition
          text: !lambda |-
            auto cond = id(weather_condition).state;
            if (cond.empty()) return std::string("");
            if (cond == "cloudy") return std::string("pochmurno");
            if (cond == "clear-night") return std::string("bezchmurnie");
            if (cond == "fog") return std::string("mgła");
            if (cond == "hail") return std::string("grad");
            if (cond == "lightning") return std::string("burza");
            if (cond == "lightning-rainy") return std::string("burza");
            if (cond == "partlycloudy") return std::string("cz. zachmurzenie");
            if (cond == "pouring") return std::string("ulewa");
            if (cond == "rainy") return std::string("deszcz");
            if (cond == "snowy") return std::string("śnieg");
            if (cond == "snowy-rainy") return std::string("śnieg z deszcz.");
            if (cond == "sunny") return std::string("słonecznie");
            if (cond == "windy") return std::string("wietrznie");
            if (cond == "windy-variant") return std::string("wietrznie");
            if (cond == "exceptional") return std::string("wyjątkowo");
            return std::string(cond.c_str());
      - lvgl.label.update:
          id: lbl_pogoda_details
          text: !lambda |-
            float h = id(weather_humidity).state;
            float d = id(weather_dew_point).state;
            if (std::isnan(h)) return std::string("");
            char buf[40];
            if (!std::isnan(d)) {
              snprintf(buf, sizeof(buf), "\U000F058E %.0f%% · p.rosy %.0f °C", h, d);
            } else {
              snprintf(buf, sizeof(buf), "\U000F058E %.0f%%", h);
            }
            return std::string(buf);
      - lvgl.label.update:
          id: lbl_pogoda_icon
          text: !lambda |-
            auto cond = id(weather_condition).state;
            if (cond.empty()) return std::string("");
            if (cond == "cloudy") return std::string("\U000F0590");
            if (cond == "clear-night") return std::string("\U000F0594");
            if (cond == "fog") return std::string("\U000F0591");
            if (cond == "hail") return std::string("\U000F0592");
            if (cond == "lightning") return std::string("\U000F0593");
            if (cond == "lightning-rainy") return std::string("\U000F067E");
            if (cond == "partlycloudy") return std::string("\U000F0595");
            if (cond == "pouring") return std::string("\U000F0596");
            if (cond == "rainy") return std::string("\U000F0597");
            if (cond == "snowy") return std::string("\U000F0598");
            if (cond == "snowy-rainy") return std::string("\U000F067F");
            if (cond == "sunny") return std::string("\U000F0599");
            if (cond == "windy") return std::string("\U000F059D");
            if (cond == "windy-variant") return std::string("\U000F059E");
            return std::string("\U000F0590");
