esphome:
  platformio_options:
    build_flags:
      - "-DCONFIG_COMPILER_OPTIMIZATION_PERF=y"
    board_build.arduino.memory_type: qio_opi

esp32:
  flash_size: 16MB
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_COMPILER_OPTIMIZATION_PERF: "y"
      CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_240: "y"

psram:
  speed: 80MHz

# --- Time ---
time:
  - platform: homeassistant
    id: ha_time

# --- Sensors ---
sensor:
  - platform: homeassistant
    id: weather_temp
    entity_id: weather.openweather
    attribute: temperature
  - platform: homeassistant
    id: weather_humidity
    entity_id: weather.openweather
    attribute: humidity
  - platform: homeassistant
    id: weather_dew_point
    entity_id: sensor.openweather_dew_point

text_sensor:
  - platform: homeassistant
    id: weather_condition
    entity_id: weather.openweather

# --- Fonts ---
font:
  - file: "gfonts://Montserrat"
    id: icon_font_14
    size: 14
    bpp: 4
    glyphs: " !%+,-./0123456789:°CAbcdefghijklmnoprstuwyząćęłńóśźż"
    extras:
      - file:
          type: web
          url: "https://github.com/Templarian/MaterialDesign-Webfont/raw/master/fonts/materialdesignicons-webfont.ttf"
        glyphs:
          - "\U000F0590"  # weather-cloudy
          - "\U000F0591"  # weather-fog
          - "\U000F0592"  # weather-hail
          - "\U000F0593"  # weather-lightning
          - "\U000F0594"  # weather-night
          - "\U000F0595"  # weather-partly-cloudy
          - "\U000F0596"  # weather-pouring
          - "\U000F0597"  # weather-rainy
          - "\U000F0598"  # weather-snowy
          - "\U000F0599"  # weather-sunny
          - "\U000F059D"  # weather-windy
          - "\U000F059E"  # weather-windy-variant
          - "\U000F067E"  # weather-lightning-rainy
          - "\U000F067F"  # weather-snowy-rainy
          - "\U000F058E"  # water-percent
          - "\U000F050F"  # thermometer
  - file: "gfonts://Montserrat"
    id: icon_font_28
    size: 28
    bpp: 4
    glyphs: " "
    extras:
      - file:
          type: web
          url: "https://github.com/Templarian/MaterialDesign-Webfont/raw/master/fonts/materialdesignicons-webfont.ttf"
        glyphs:
          - "\U000F0590"  # weather-cloudy
          - "\U000F0591"  # weather-fog
          - "\U000F0592"  # weather-hail
          - "\U000F0593"  # weather-lightning
          - "\U000F0594"  # weather-night
          - "\U000F0595"  # weather-partly-cloudy
          - "\U000F0596"  # weather-pouring
          - "\U000F0597"  # weather-rainy
          - "\U000F0598"  # weather-snowy
          - "\U000F0599"  # weather-sunny
          - "\U000F059D"  # weather-windy
          - "\U000F059E"  # weather-windy-variant
          - "\U000F067E"  # weather-lightning-rainy
          - "\U000F067F"  # weather-snowy-rainy

# --- LVGL UI ---
lvgl:
  pages:
    - id: main_page
      bg_color: 0x000000
      scrollbar_mode: "OFF"
      scrollable: false
      widgets:
        # Status bar
        - obj:
            width: 800
            height: 32
            border_width: 0
            radius: 0
            scrollbar_mode: "OFF"
            scrollable: false
            x: 0
            y: 0
            bg_color: 0x1A1A1A
            bg_opa: COVER
            pad_left: 8
            pad_right: 8
            widgets:
              - label:
                  id: lbl_clock
                  align: LEFT_MID
                  text_color: 0xFFFFFF
                  text_font: montserrat_28
                  text: "--:--"
              - label:
                  id: lbl_weather_icon
                  align: LEFT_MID
                  x: 130
                  text_color: 0xFFFFFF
                  text_font: icon_font_28
                  text: ""
              - label:
                  id: lbl_weather_text
                  align: LEFT_MID
                  x: 164
                  text_color: 0xFFFFFF
                  text_font: icon_font_14
                  text: ""
              - label:
                  id: lbl_date
                  align: RIGHT_MID
                  text_color: 0xFFFFFF
                  text_font: montserrat_14
                  text: ""

# --- Clock update ---
interval:
  - interval: 1s
    then:
      - lvgl.label.update:
          id: lbl_clock
          text: !lambda |-
            auto now = id(ha_time).now();
            if (!now.is_valid()) return std::string("--:--");
            char buf[6];
            snprintf(buf, sizeof(buf), "%02d:%02d", now.hour, now.minute);
            return std::string(buf);
      - lvgl.label.update:
          id: lbl_weather_icon
          text: !lambda |-
            auto cond = id(weather_condition).state;
            if (cond.empty()) return std::string("");
            if (cond == "cloudy") return std::string("\U000F0590");
            if (cond == "clear-night") return std::string("\U000F0594");
            if (cond == "fog") return std::string("\U000F0591");
            if (cond == "hail") return std::string("\U000F0592");
            if (cond == "lightning") return std::string("\U000F0593");
            if (cond == "lightning-rainy") return std::string("\U000F067E");
            if (cond == "partlycloudy") return std::string("\U000F0595");
            if (cond == "pouring") return std::string("\U000F0596");
            if (cond == "rainy") return std::string("\U000F0597");
            if (cond == "snowy") return std::string("\U000F0598");
            if (cond == "snowy-rainy") return std::string("\U000F067F");
            if (cond == "sunny") return std::string("\U000F0599");
            if (cond == "windy") return std::string("\U000F059D");
            if (cond == "windy-variant") return std::string("\U000F059E");
            return std::string("\U000F0590");
      - lvgl.label.update:
          id: lbl_weather_text
          text: !lambda |-
            auto cond = id(weather_condition).state;
            float temp = id(weather_temp).state;
            float hum = id(weather_humidity).state;
            float dew = id(weather_dew_point).state;
            if (cond.empty() || std::isnan(temp)) return std::string("");
            std::string desc;
            if (cond == "cloudy") desc = "pochmurno";
            else if (cond == "clear-night") desc = "bezchmurnie";
            else if (cond == "fog") desc = "mg\u0142a";
            else if (cond == "hail") desc = "grad";
            else if (cond == "lightning") desc = "burza";
            else if (cond == "lightning-rainy") desc = "burza";
            else if (cond == "partlycloudy") desc = "cz. zachmurzenie";
            else if (cond == "pouring") desc = "ulewa";
            else if (cond == "rainy") desc = "deszcz";
            else if (cond == "snowy") desc = "snieg";
            else if (cond == "snowy-rainy") desc = "snieg z deszcz.";
            else if (cond == "sunny") desc = "slonecznie";
            else if (cond == "windy") desc = "wietrznie";
            else if (cond == "windy-variant") desc = "wietrznie";
            else desc = cond;
            char buf[80];
            snprintf(buf, sizeof(buf), "%.0f°C  %s", temp, desc.c_str());
            std::string result = buf;
            if (!std::isnan(hum)) {
              snprintf(buf, sizeof(buf), "   \U000F058E %.0f%%", hum);
              result += buf;
            }
            if (!std::isnan(dew)) {
              snprintf(buf, sizeof(buf), "   \U000F050F %.0f°C", dew);
              result += buf;
            }
            return result;
      - lvgl.label.update:
          id: lbl_date
          text: !lambda |-
            auto now = id(ha_time).now();
            if (!now.is_valid()) return std::string("");
            const char *days[] = {"niedz.", "pon.", "wt.", "śr.", "czw.", "pt.", "sob."};
            const char *months[] = {"stycznia", "lutego", "marca", "kwietnia", "maja", "czerwca",
                                    "lipca", "sierpnia", "września", "października", "listopada", "grudnia"};
            char buf[40];
            snprintf(buf, sizeof(buf), "%s, %d %s %d r.", days[now.day_of_week - 1], now.day_of_month, months[now.month - 1], now.year);
            return std::string(buf);
